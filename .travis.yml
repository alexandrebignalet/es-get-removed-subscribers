language: php
sudo: false
php: 7.1
cache:
  directories:
  - "$HOME/.composer/cache"
env:
  global:
  - DEPLOY_DIR=/home/git/es-get-removed-subscribers
  - secure: YnNB3c5nMhJNkDgB0kX+N7TJENO73qdZKSiVakp0ZKHHwl+jWW44NVaD4o2ur1wILoMriegldWhqgM61XdQxNwFoBVCDsXxFZDb36aMm1pnow5Ii9ZRcfhwc1SzjKUcrOIugfVr2xoxFNy3L+EGE/hvwwWsv/iBo0aO7dGUHjnCzL3d8+s/98GV0n1J1QMQrodTtEy7k6oxKx2zl7KlAcFm57K6oN3MOb/DshfCqYxQDCXx1QFlkxUxe54tp29xDRi3Z1u8F1UfTGKLf9xE0jX8Ty9+Yztih1dC4nNG5uCTc1PeqAvpUFZ2qrrjUnbhsK3bwCD2qyX8fZyI+LHOI32S45RR/fCOCnVnKeDNz7vURaFR4V3aPi8qxUQtIdmi6gwX5KYMYaTowPBIoderOX1fT1yP6f5Fg8I3ngYdxHkq1dp1/d8kT6+WwPV+0fqPm2neXaY/337jHoX5sJHLF9CWAOtHFCjOHxE5HycjXPFqV8d9DdZHghdR8wPjc9OIzrgpbzagcKhCY6mtuqYlKHFjdVU3XfmSzxbJXWu2rlvwLIhxPdrpqfX9pNlmnAH48jhGyj5ey6IGClCjr3fGaTxFtJT8mdwhbdzY03Fw5ZURjsOHy+9ZfW3gIdfE7AhUrg4TRuUxrQUOkHnzKpUHifm+vI1FBG+Ef9Vfar/ynybo=
  - secure: zHp0dI8pMDd5BY24pPRt/1a5NWa0YHDYjXdkXV/Zyp6Hw6+PP7RCyr0b3iCWrjaxvgHkHLnq8GgyiwKZOKxgEQA0OJRqx8okeSyOmNBu2NeJlwxsqlSFM2ZUOwpFz5K0li4qan+rfkBM1aFOfoVNMIKvmTDdOSKJzFenEZZIEX8Jek+7DUVV6CVVcoA0UR2PflbWaWwg3Ww9mIpomj2lzFJY9D3orqfNPnJ16/t64Di1b/XCsgBbp0Le7s5rlsBnTMYN6i1mEALfIp7ifEalFqqEuV2yC848nWJcp/2Y3VCZAUNLkeYp8M/h8GwePICKW/LFi4gz/G+m6RfpMQHaw6w1oT5F5KopuNoSYari8bvN820VQe4iW5ZpPJN9KU2ZYjRDxL334W3Fuo0Qm4JfSqmjAkaPb064bmC415PgGZRKToqHHHP38JYggNjfbNtL7rwWmSz377bvOX+pI7PmQbQFE4P5xjfi/XQ4cE+nzXL4EF74SY+albYL7zo20a1uCWBxVb4buPrYZhcrYxlPpKljSgkKGb5wHCFvOAH50n7WpVj5RF6QsdaJSyRPOl6iF7aT0YHbsyTz4seKidGWkxFqv9nmNft8dz9mEdjXtqkZD8jv2b0gdNd9wrQhAPKsYZnu8prsROeTefU0tbvMFn/dak3tFfaq7A+QgcyqvAA=
  - secure: OQqwUhEOXbJYAw3f4MPi7/g9ft9+A1RWZTWTfLAb+hR7Rpa8tLnxDKS9JzmGmtSa4zR0dUoK14nc4JepLgqoiUSfGzt8ULqY8pmulD6W55GrKJai5Rk8NJczTXQU+0GLZnRb3YV3m/dcz8SoAmO3YXGNTsXqUPghQMnrrqmNE5R8dvv9wJgU3peN1fgkUlZ9EMJv8+FjCvvZjY4tvSFRKc3CHj1UprZua50YTaHtFScunOwjjEDKnKoBoKHDkd0gpKPcclhgSRH6Ia4jN1Ijl1OtoAdXmbx+d02bIGL+fUvQDZ7JgO7jFrfugqC6FowYGoA4GCzvD/dkDYC1cZdIMuO6SD8aAqC302901pR9Zd+JjD2S03NWb6XekVJaRTHSNEAuwEqJTWNhczr9Fplrh/ZhK3i685upWmy0n7opSJYHATRf50Wvrm0oHP3ph0Ix1cPNrf50AgwMtGNyWpK6xJYaE1oAOIZTAFP88mFd2gaF43BC761piy25m6AzCzyD1Y0OR9gqi7pwVeaeLQziEyvhTj9W/01MiQXmlTgcjh7qw2mjEf1Uz5c6wPolyXKEFji4s7eiOwkqqBrfTjpirmDtNxLn8miL15A+bA6U33EmoCv+rsoi38VSOCSNmiwOm7OItYWYzogJbCBBRAsafsi1bp4sWo2l8rA41RlRWRM=
  - secure: LLyso7+jqh+7k/nC1ZWZ2ylts8oMtwaT6YGdau372v5Ld78pQV3BZFHsu6KrMugptqkkbpmqMk59QfHFdLFmwHpinmw4P/D63aIeKeCjvA0gDDY3UroMpsDPMY0FV1p6K+HoZTFdfkhVxID4qr1eKR8RDiABfDbaDwTnr4k7nNWtVAECQi2Sj4zdMaAeaR61y3iDOagkNGtCgeHK0p1cOME7D6+EUSN8rUfR1FDLbhfv083qEj0+bnNx2UmPolOsfPvwtecNpDbs3Wg5L/lm+vE2pvprCPZWkL7xvDglCoMzavPCUxC0C7RxUP8f0GJC2+78ArZA/XbfZD6HjFbl/3WaXdkIm65Bv7Ga7cUhraMvuzdAsAlooQmjLvyvl8yMeIZV18oIrBSx54DACmSzE7SogMb0sRNi3fLeHlzGbDio653+rXH7T3J1MO6DJomduWejNUNq8MZiAEMzSRrC8MJK9kM2CPPfSJvwBZ4vhdFZk7DABWxMPxNr8xAqjgaPE4yri7L22jecvNAx/aBmowGE+HXG6hdAb0kLUqy/e86C2gnKXxDUmzdV5Tm+z159kCk44c1KenTNwMg7j4ahSFS1jfudob+LnOACjNFWhv0A+QD3AME2A0hnHtLW00Mu4tL4e2gdbwppbcEP9+QCf2121MbnIm6s8J/Jtgx6WQg=
  - secure: tUSIARhmRMIcmno3u4YvXWD44pSolPxL+NVygnw1pdCNRG/lDvHgGs5iUZ+eUn2Ovu949RyrS7FhcAPkKst6pNg/D0tf/GBo4snvpQaCUYJCkuoJ73BJ9u/i4f0uFyfWdRHtvIGNh8sAPKNXtLyvsemojg7KI8dWfe6KqgS7/PkWckYhdFjKYNy9jg2mPisI9TBJKsLgEs+iPyU98T9G/oYPCi3KJPBVCcu0pyyLqhGxwvWSmW8OmJBlxod4ThPDKffVk560+96lhXF5eRUC0UBLU+ESBpWlvK06iZzjb9qfh48L1JVBtwQmZqkOEmxdkyNAGDWEv7S7+Q4vuFGtbSkBixCnBC8jm4M/xMOGED0SqjeLBer5Sy5TfDVHc++MGCTxdzD/rVUATxMqEziMo518x2vf6a7w3efvFdeDG++yrUuXf6VHt9zOelwIIkg+73/OorGtQfu5RDsVArapeHYNE6Jbh/lZz/tLhgm7T3o1c9lD3EJg8HwZ3VsXzQ7ycjSnSccRUTkkv9g3jrietgzGYc32gWgxXp9APnfCENhrAjC/oFvi45e+wMFahV2ZTaS3alZhKdX6ldvaMUtFiMH5yZb1NEySOtBiYJLAmEneQzJKEdLp0wRhAhiOjUZ/F/VaK6uLAff1lwZO/j4CK0JK/absIo12TorMXbvkRGQ=
  - secure: KMEiNNs0v6aKpsFcrE+ZMUaPRVCDZu48sMpkRBE0zZwaCXFWgVHy77EU5znRfNB3IKBD1In4MBWItk5x9+fYGEqwnWa7zCXemvoYWUmA3dTmsmuzwAFVFsqTIlqTKNI3Xrscr8YLSkk+CRxlnR+VQp6XdEmSNllg9m8OGb6HOELMnPBQw/KTb7ygfiuhwvNTZerGG4zFJVlo6YMFufNmvkAYRcPP8OOpuWVOLMFVHpKs9nN6kr48oWGF55R5qvcUpAu0QC0qJyH+u6S2rAvPatevqEgmUKT4S0AsvWl2FgVXELrLBXmAQIR1NEUMuHJbkFlKPo5U20IKrWAd40cKK/U5SPYtuXW3u+qXG7K2ss0UH7FN/bq3ToA9KbSJB8y9Rf0KYuLk9XbX6SJGrENExIRiv7uBrKTgSO/PKM/HWwMHKHa7bavyGiOW76JJNLQxxjbHyiWHxjAcq4h8P4ePAf9wLkkt/zZ3pLL39Ki5rPaPHPpkhVqEb+a80QhPHgVkYSfaBgIzFf+9JhrN7+0Vss1i8lnaa7UchvOZGWMCLnWYK6Oth9he05NSLcexO/UQ7JwjHXvHzJ8rSy82wKdnkaGcGOHjXdQESCgTVC8YiU4WGOw9n4ZndSre+sXjlbLRveXGKX3eUhALySJ73Vj2wyU64cX2U3xsMeEK6SDRjtc=
  - secure: LZY5qb889dMcqyA8WBMy3Cem+OYEVsTIt4slj3Z0uUmWHtZQ7kAwi4qZUj2+XcYU9I2KV+UJeysa1EhMyVQHWesrWuFs+X9dAOS5gcNOZk+kbyzoSRDJ+3I5NPfwkF88K+CxsnirtDzL2ITcHv8feP0Lp3g9XSkJlaQgZjQzB4hvXp05be9gHi8jI/nZe5KNxOGwGT85JTGAHxVgNJhgChNmStA96/g8nCbUU/j7epVnYPQFBIbO5inLFCGStg3Q+kx47MiL3DF9/jQIL0V5BLogfP5I6593jr/rlyvjGVmTZquVKkr7XxQzq9LvRzbjn6i27sBO1VPVBMLj3mWvisTDz1DDIJl5WFgVoYpSwIESUvN/yg3stAYKwnu955qQ5yAhyamgJE3l7ml3nivYtqidE0+SwB03M0MmV/ZvD+HJjBDrOVzpn7eQK8H8lc/PUXmx6QxfT9LVUUzzfBM02GC3f4dXZiZK0/ALFTDEEG8iAOeuFQ4LRlX2HnX/UOwfPbCqB7JnAEwTiMJfH84SP/G0DdEok49o2QyjXSiV5jcai02gnAtRiHWgdZcM0IEhgx2EmXmak7G5yI3un/Mvwi5DEZ+24sTyLSAC/TnYf7tX1OrPUaEzZtuvhnA3A24Mj9hw8O1k6Ao7wd9zlNSXkuHURIbV3zffPM/8dTHlsfc=
install: composer install
jobs:
  include:
  - stage: build
    script: "$TRAVIS_BUILD_DIR/vendor/bin/phpunit"
  - stage: push
    if: branch = master AND type = push
    before_script:
    - openssl aes-256-cbc -K $encrypted_dc9d850b4010_key -iv $encrypted_dc9d850b4010_iv
      -in deploy_key.enc -out ./deploy_key -d
    - eval "$(ssh-agent -s)"
    - chmod 600 ./deploy_key
    - echo -e "Host $SERVER_IP\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
    - ssh-add ./deploy_key
    script: "./release.sh"
